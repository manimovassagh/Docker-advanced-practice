name: PostgreSQL with Data Mount

on: [push]

jobs:
  
  postgres-job:
    runs-on: ubuntu-latest
    steps:
      - name: pwd
        run: pwd
      - name: List root directory contents
        run: ls /
      - name: List repository directory contents
        run: ls -R ${{ github.workspace }}

        

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Verify directory exists
        run: |
          if [ -d "${{ github.workspace }}/mounter" ]; then 
            echo "Directory exists"; 
            ls -R ${{ github.workspace }}/mounter; 
          else 
            echo "Directory does not exist"; 
            exit 1;
          fi

      - name: Wait for PostgreSQL to be ready
        run: sleep 30

      - name: Query Data
        run: |
          docker exec -i ${{ job.services.postgres.id }} psql -U myuser -d mydatabase -c "SELECT * FROM employees;"